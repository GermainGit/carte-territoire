
<p id="notice"><%= notice %></p>

<h1>Photos</h1>
<div id="mapid"></div>
<table>
  <thead>
    <tr>
      <th>Titre</th>
      <th>Contenu</th>
      <th>Longitude</th>
      <th>Latitude</th>
      <th>Date</th>
      <th>Créé par</th>
      <th colspan="3"></th>
    </tr>
  </thead>
  <tbody>
    <% @photos.each do |photo| %>
      <tr>
        <td><%= photo.title %></td>
        <td><%= photo.content %></td>
        <td><%= photo.long %></td>
        <td><%= photo.lat %></td>
        <td><%= photo.date %></td>
        <td><%= photo.user %></td>
        <td><%= link_to 'Afficher', photo %></td>
        <% if user_signed_in? && current_user.id == photo.id  %>
          <td><%= link_to 'Modifier', edit_photo_path(photo) %></td>
          <td><%= link_to 'Supprimer', photo, method: :delete, data: { confirm: 'Etes-vous sur ?' } %></td>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>

<br>
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>
   https://unpkg.com/leaflet.markercluster@1.4.1/dist/

<script>
  var map = new L.Map('mapid').setView([44.84561111, -0.58027778], 6);

 L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
    maxZoom: 18,
    minZoom: 10
 }).addTo(map);
 map.attributionControl.setPrefix('');

var southWest = L.latLng(43.58155760646617, -0.90),
northEast = L.latLng(46.99346179538875, -0.02);
var bounds = L.latLngBounds(southWest, northEast);

map.setMaxBounds(bounds);
map.on('drag', function(){
  map.panInsideBounds(bounds, { animate: true});
});

 // Define an array. This could be done in a seperate js file.
 // This tidy formatted section could even be generated by a server-side script
 // or fetched seperately as a jsonp request.



<% @photos.each do |photo| %>
    var long = <%= photo.long %>;
    var lat = <%= photo.lat %>;
    var popupText = "<%= photo.title %>";
    var icon = L.icon({
      iconUrl: '<%= photo.file %>',
      iconSize: [45, 45]
    });
    var markerLocation = new L.LatLng(lat, long);
    var marker = new L.Marker(markerLocation, {icon: icon});
    map.addLayer(marker);

    marker.bindPopup(popupText);

<% end %>

</script>
<%= link_to 'Nouvelle photo', new_photo_path %>
