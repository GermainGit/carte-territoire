<% content_for :title, "La carte & le territoire" %>


  <div id="mapid"></div>

  <div id="notice"><%= notice %></div>

<div class="container feed">
  <div class="row">

    <div class="card-columns">
<% @photos.reverse_each do |photo| %>

  <div class="card">
    <a href="photos/<%= photo.id %>">
    <img class="card-img-top" src="<%=  photo.file %>" alt="<%= photo.title %>">
    </a>
    <div class="card-body photo_content">
      <h5><%= link_to photo.title.truncate(120, separator: ' '), photo, :class => "card-title" %></h5>
      <p class="card-text"><%= photo.content.truncate(255, separator: ' ') %></p>
      <% if(user_signed_in? && current_user.admin) %>
        <%= link_to 'Modifier', photo %>
        <%= link_to 'Supprimer', photo, method: :delete %>
      <% end %>
    </div>
  </div>
    <% end %>
       </div>
         <%= paginate @photos, theme: 'twitter-bootstrap-4', class: "navpagination" %>
  </div>
</div>

<br>
<script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
   integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
   crossorigin=""></script>

<script>
  var map = new L.Map('mapid').setView([44.84561111, -0.58027778], 6);

 L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-lite/{z}/{x}/{y}{r}.{ext}', {
    attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors',
    maxZoom: 18,
    minZoom: 8,
    ext: 'png'
 }).addTo(map);
 map.attributionControl.setPrefix('');

var southWest = L.latLng(43.18155760646617, -5.90),
northEast = L.latLng(47.69346179538875, 5.3);
var bounds = L.latLngBounds(southWest, northEast);

map.setMaxBounds(bounds);
map.on('drag', function(){
  map.panInsideBounds(bounds, { animate: false});
});

 // Define an array. This could be done in a seperate js file.
 // This tidy formatted section could even be generated by a server-side script
 // or fetched seperately as a jsonp request.



<% @dbphotos.each do |photo| %>
    var long = <%= photo.long %>;
    var lat = <%= photo.lat %>;
    var icon = L.icon({
      iconUrl: '<%= photo.file %>',
      iconSize: [25, 25],
    });
    var markerLocation = new L.LatLng(lat, long);
    var marker = new L.Marker(markerLocation, {icon: icon});
    map.addLayer(marker);

    marker.on("click", function (event) {
    var clickedMarker = event.layer;
    document.location.href="photos/<%= photo.id %>";
});

<% end %>

</script>

